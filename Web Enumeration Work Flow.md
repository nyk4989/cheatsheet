# # SQLi [CheatSheet](obsidian://open?vault=CheatSheet&file=ChatSheet%2F%E8%84%86%E5%BC%B1%E6%80%A7%E5%88%A5%2FSQL%20Injection)
## ## 1. URLパラ、POSTパラ、JSONボディ
- 怪しい値(id / user / page)などのDBとやり取りしてそうな値がある場合にSQLiを試す。

```例
https://0afc009d047790c78112d44600d300c9.web-security-academy.net/filter?category=Gifts
```

- **Check List**
[1] クォーテーション投入  
- `'` シングルクォート  
	- [ ] レスポンスに変化あり？
	- [ ] レスポンスに変化なし？
	- [ ] SQLの構文エラーあり？
	- [ ] SQLの構文エラーなし？
- `"` ダブルクォート  
	- [ ] レスポンスに変化あり？
	- [ ] レスポンスに変化なし？
	- [ ] SQLの構文エラーあり？
	- [ ] SQLの構文エラーなし？
[2] どれか確認できたら実行  
- [ ] SQLmap投入（PoC / 自動化確認）

---
## ## 2. ログイン機能
- ログイン機能があった場合に、Bypassができないかを試みる。
	![[Pasted image 20250714001725.png]]

- **Check List**
[1] クォーテーション投入  
- `'` シングルクォート  
	- [ ] レスポンスに変化あり？
	- [ ] レスポンスに変化なし？
	- [ ] SQLの構文エラーあり？
	- [ ] SQLの構文エラーなし？
- `"` ダブルクォート  
	- [ ] レスポンスに変化あり？
	- [ ] レスポンスに変化なし？
	- [ ] SQLの構文エラーあり？
	- [ ] SQLの構文エラーなし？
**[2] 差異・エラーが確認できた場合**
- [ ] OR-based SQLi（`OR 1=1 --`）確認
- [ ] UNION SELECT 検証
---
# # XSS [CheatSheet](obsidian://open?vault=CheatSheet&file=ChatSheet%2F%E8%84%86%E5%BC%B1%E6%80%A7%E5%88%A5%2FXSS)

## ## 説明
- 反射型
入力した文字が次のページで折り返るやつ。
- 保存型
	- こういったコメント機能など次のレスポンスで折り返るとかではなく、ほかのページに入力値が保存される系のことを指す。
	![[Pasted image 20250714221329.png]]
- DOM-Base XSS
	- 受け取ったデータを`evil()`や`innerHTML`などの動的なコード実行を許すシンク(sink)に渡すことで発生する。これにより攻撃者は悪意のあるJSの実行ができてしまう。
	- ソースとシンク
		- ソースは、データを受け取る場所。
		- シンクは、受け取ったデータを処理される場所。
	- DOMベースは通信が発生しない。以下の様にクライアントのブラウザで確認ができてしまう。
		 ![[Pasted image 20250714225637.png]]
		- 上記のことからブラウザーで確認ができる。
	- ちょっとソースコードベース

## ## 折り返しの確認
注意:Payloadを入れて折り返しがなかった場合はタグとして認識はされている可能性あり。
### ### JSのエントリポイント探し
- レスポンスに文字が折り返ってきてるか？
	- Response Bodyに折り返しがあるか？
		- [ ] ある
		- [ ] ない
	- リクエストヘッダがレスポンスで折り返ってきてるか？
		- [ ] ある
		- [ ] ない
	- コンテキスト確認
		- [ ] HTMLタグ内
		- [ ] 属性内 (`href=""` や `src=""` の中)
		- [ ] JS内リテラル(`<script>` 内に入る)
		- [ ] CSS内(`style="..." `の中)
		- [ ] URLコンテキスト内(`<a href="...">`など)
		- [ ] コメント内(`<!-- --> ` 内)
		- [ ] URLの末尾に#があるもしくは#をつけて操作ができるか見る。
	- サニタイズがされているか？
		- [ ] されている。
		- [ ] されていない。
		- [ ] 不明
	- バリデーションがされているか？
		- [ ] されている。
		- [ ] されてない。
		- [ ] 不明
	- エスケープ処理
		- [ ] されてる。
		- [ ] されてない。
		- [ ] 不明
	- 以下の発火するか。
		- [ ] `<script>alert(1)</script>`
### ### DOMベースの確認方法
- 実際にどう渡されてるかを確認する。
	- [ ] ソースとシンクがどうなっているかを確認。
	- [ ] Payloadを組み立てる。例:`<img src=x onerror=alert(1)>`
		- [ ] 発火した？
		- [ ] してない？
	- `a herf`タグがあった場合
		- `javascript:alert(1);`が使えるか？
			- [ ] 発火する。
			- [ ] 発火しない。

---
# # CSRF [CSRFの説明](obsidian://open?vault=CheatSheet&file=%E5%AD%A6%E7%BF%92%E9%80%B2%E6%8D%97%E7%AE%A1%E7%90%86%2FPortSwigger%2F%E8%84%86%E5%BC%B1%E6%80%A7%E3%81%AE%E8%AA%AC%E6%98%8E%2FCross%20site%20Request%20Forgery%20(CSRF))
## ## Check Lists
- リクエストから CSRF トークンを削除するか、空白スペースを入れます。
	- [ ] 正常遷移
	- [ ] それ以外
- POSTをGETに変更します。
	- [ ] 正常遷移
	- [ ] それ以外
- CSRF トークンをランダムな値 (たとえば 1) に置き換えます。
	- [ ] 正常遷移
	- [ ] それ以外
- CSRF トークンを同じ制約のランダム トークンに置き換えます。
	- [ ] 正常遷移
	- [ ] それ以外
- HTML インジェクションを使用してトークンを抽出します。
	- [ ] できる
	- [ ] できない
- 以前使用されたことのある CSRF トークンを使用します。
	- [ ] 正常遷移
	- [ ] それ以外
- リファラーヘッダーを削除します。
	- [ ] 正常遷移
	- [ ] それ以外
---
# # IDOR(安全ではない直接オブジェクト参照)/Access Control
## ## Check Lists
- [管理画面の露呈]:
	- Directory BruteForseで管理画面の露呈がないか。
		- [ ] ある
		- [ ] ない
	- Robots.txtに管理画面に繋がるディレクトリがないか。
		- [ ] ある
		- [ ] ない
	- HTML内に管理画面に繋がるURLがないか。
		- href属性にないか。
			- [ ] ある
			- [ ] ない
		- scriptタグの中にないか。
			- [ ] ある
			- [ ] ない
- [ログイン時にアクセス制御をしてないか]:
	- ログイン時にユーザの権限を制御しているパラメータがないか。
		- [ ] ある
		- [ ] ない
	- cookieに権限の制御がされている箇所がないか。(`Cookie: Admin=false; session=5hh0u1RECHeGVLAcbVkZukRRltm9pqun`)←Adminのfalseをtrueに変えると攻撃は成功する。
		- [ ] ある
		- [ ] ない
	- ユーザ更新した後レスポンスでRoleが返されるか。
		以下みたいな感じで`ruleid`みたいなのがあるか。
		```
		{
		  "username": "wiener",
		  "email": "wiener@normal-user.net",
		  "apikey": "jMZuAzR8TaeyfbXsMVeJsAGszmAq5ILK",
		  "roleid": 2
		}
		```
		- [ ] ある
		- [ ] ない
- [パラメータの値変え]:
	- パラメータにユーザを識別している箇所はないか。`id=1`とか
		- [ ] ある
		- [ ] ない
	- パラメータの値は推測できるか。
		- [ ] できる
		- [ ] できない
		- できない場合どこかの画面で入手することは可能か？(画面ではなくレスポンスを見ろ)
			- [ ] 可能
			- [ ] 不可能
	- 値を書き換えた場合にログインページに戻されるか。
		- [ ] 戻される
		- [ ] 戻されない
		- 戻される場合リダイレクトされるか。
			- [ ] される
			- [ ] されない
		- リダイレクトの画面に機密情報はないか。
			- [ ] ある
			- [ ] ない
- [Webで機密情報の露呈]
	- `.txt`,`.md`,`.bk`などの拡張子でファイルが公開されていないか。(feroxbusterなどを推奨)
		- [ ] されている
		- [ ] されていない。
- [悪用]:
	- パスワードがマスクされている画面をhtml表示したときに平文でパスワードが閲覧可能か。
		- [ ] 可能
		- [ ] 不可能

---
# # SSRF(サーバサイドリクエストフォージュリー)

## ## CheckLists
- リクエストで他サーバにアクセスしている箇所がないか。
	- [ ] ある:SSRFの疑いあり。
	- [ ] ない

---
# # JWT Attack
- JWTが使われている
	- [ ] 使われている : 診断対象
	- [ ] ない : 診断対象外

---
## ## NoSQL Injection
### ### 構文インジェクションの場合
1. ファジング文字列。これによりサニタイズ、フィルタリングがされていないかどうかわかる。
```

'"`{
;$Foo}
$Foo \xYZ

```
 - Responseに変化はあるか？
	 - [ ] ある。(500エラーなどがあるか):2へ
	 - [ ] なし。
	- 注意点:JSONプロパティ経由である場合は調整も必要。またファジング文字列もこれがすべてではない。
2. 処理される文字の特定。
	- 上記の文字を一文字ずつ送り、どの文字で構文エラーが起きるか確認をする。
3. 条件付き動作の確認
```
'&&0&&'x # 偽 ←偽の挙動は、在庫確認であれば在庫が0と同じ挙動になるはず。
'&&1&&'x # 真 ←真の挙動は、在庫ありの状態と同じになる。
```
 - 偽と真の条件を持つリクエストを2つを順に追加して、変化があるか？
	 - [ ] 変化あり : 悪用へ
	 - [ ] 変化なし
### ### 演算子インジェクションの場合